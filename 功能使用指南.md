# SURF Application Website - 新功能使用指南

## 📧 Gmail集成与邮件追踪

### 功能概述

现在系统已经集成了Gmail API，支持以下功能：

1. **直接发送邮件** - 从应用内向PI发送邮件
2. **自动追踪回复** - 实时检查PI是否回复
3. **智能提醒** - 自动提醒需要follow-up的邮件
4. **邮件状态管理** - 追踪每封邮件的状态和thread ID

### 📁 材料文件管理

1. **本地上传** - 上传CV、推荐信等文件到本地服务器
2. **Google Drive集成** - 直接上传到Google Drive并获取共享链接
3. **文件链接管理** - 在材料任务中管理所有文件链接

## 🚀 快速开始

### 1. 配置Google OAuth

首次使用前需要配置Google OAuth认证：

1. 访问 [Google Cloud Console](https://console.cloud.google.com/)
2. 创建新项目
3. 启用 Gmail API 和 Google Drive API
4. 创建 OAuth 2.0 凭据（Desktop app类型）
5. 下载 `credentials.json` 文件
6. 将文件放在 `server/` 目录下

详细步骤请查看 `server/README.md`

### 2. 启动后端服务器

```bash
# 确保已安装依赖
npm install

# 启动后端服务器（3001端口）
npm run server

# 启动前端开发服务器（另一个终端）
npm run dev
```

首次启动服务器时，会自动打开浏览器要求授权，允许应用访问你的Gmail和Drive。

### 3. 启动前端

```bash
npm run dev
```

## 💡 功能使用说明

### 发送邮件给PI

1. 在 **Outreach** 标签页中，打开任意outreach记录的详情
2. 在 **Contact** 字段输入PI的邮箱地址
3. 点击 **Send Email** 按钮
4. 系统会自动：
   - 发送邮件
   - 保存thread ID
   - 设置3天后的follow-up提醒
   - 更新stage为"Sent"

### 检查邮件回复

1. 在outreach详情中，找到 **Reply Status** 字段
2. 点击 **Check Replies** 按钮
3. 系统会自动检查该thread的新回复
4. 如果有回复，会自动更新状态

### 自动Follow-up提醒

系统会自动在Dashboard显示需要follow-up的邮件：

- 每小时自动检查一次
- 3天未回复的邮件会显示在提醒卡片中
- 点击 **Dismiss All** 关闭提醒

### 上传材料文件

在 **Materials** 标签页：

1. 打开任意material task的详情
2. 在 **Link / Attachment** 字段：
   - 点击 **Upload Local** - 上传到本地服务器
   - 点击 **Upload to Drive** - 上传到Google Drive
   - 或直接粘贴Google Doc/Drive链接
3. 文件上传后，链接会自动填充

### 管理推荐信邮件

创建专门的Material Task用于追踪推荐信：

1. Type选择 "Recommendation Letter"
2. Owner填写推荐人姓名
3. Dependency记录需要完成的前置条件
4. Due设置提交截止日期
5. 在Notes中记录邮件沟通情况

然后在Outreach中创建对应的outreach记录，追踪与推荐人的邮件往来。

## 🔔 提醒机制

### Dashboard提醒卡片

Dashboard会显示以下提醒：

- **黄色卡片** - 需要follow-up的邮件
- 显示距首次联系的天数
- 标记"Action Required"表示需要立即处理

### 后端自动任务

服务器每天上午9点自动运行检查任务：

- 检查所有未回复的邮件
- 超过3天未回复的标记为需要follow-up
- 可以在 `server/server.js` 中修改定时规则

## 🎯 工作流建议

### PI联系流程

1. **准备阶段**
   - 创建Project记录
   - 创建相关Material tasks（CV, RS等）
   - 上传材料文件

2. **发送初次邮件**
   - 创建Outreach记录
   - 填写PI信息和Contact
   - 点击Send Email发送

3. **追踪回复**
   - 系统自动设置3天后提醒
   - 定期点击Check Replies检查
   - 收到回复后更新Reply Summary

4. **Follow-up**
   - Dashboard会自动提醒
   - 必要时发送follow-up邮件
   - 更新Next Follow-up日期

### 推荐信管理

1. 为每个推荐人创建Material Task
2. 创建对应的Outreach记录追踪邮件
3. 在Dependency中记录需要提供的材料
4. 使用Check Replies追踪推荐人回复
5. 在Notes中记录提交状态

## 🔒 安全提示

⚠️ **重要**: 
- `credentials.json` 和 `token.json` 已添加到 `.gitignore`
- 不要分享这些文件给任何人
- 不要提交到Git仓库
- 定期检查OAuth权限

## 🐛 故障排除

### 服务器启动失败

```bash
# 检查端口是否被占用
lsof -i :3001

# 重新安装依赖
rm -rf node_modules
npm install
```

### OAuth认证失败

1. 删除 `server/token.json`
2. 重启服务器
3. 重新授权

### 邮件发送失败

1. 检查Gmail API是否已启用
2. 确认OAuth权限包含 `gmail.send`
3. 验证收件人邮箱格式

### 文件上传失败

1. 检查 `server/uploads/` 目录是否存在
2. 确认Drive API已启用（上传到Drive时）
3. 检查文件大小限制

## 📚 相关文档

- [后端服务器详细文档](server/README.md)
- [Google Gmail API文档](https://developers.google.com/gmail/api)
- [Google Drive API文档](https://developers.google.com/drive/api)

## 🎨 未来改进方向

1. **邮件模板系统** - 预设常用邮件模板
2. **批量发送** - 一次向多个PI发送邮件
3. **高级提醒规则** - 根据不同场景设置提醒
4. **邮件分析** - 统计回复率、响应时间等
5. **推荐信专用面板** - 专门的推荐信管理界面
